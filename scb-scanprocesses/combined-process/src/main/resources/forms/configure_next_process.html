<!--
  ~ /*
  ~ * SecureCodeBox (SCB)
  ~ * Copyright 2015-2018 iteratec GmbH
  ~ *
  ~ * Licensed under the Apache License, Version 2.0 (the "License");
  ~ * you may not use this file except in compliance with the License.
  ~ * You may obtain a copy of the License at
  ~ *
  ~ * 	http://www.apache.org/licenses/LICENSE-2.0
  ~ *
  ~ * Unless required by applicable law or agreed to in writing, software
  ~ * distributed under the License is distributed on an "AS IS" BASIS,
  ~ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ * See the License for the specific language governing permissions and
  ~ * limitations under the License.
  ~ */
  -->

<h2>Please configure the Next Scan</h2>

<form role="form" name="configure-combined-target">

    <script cam-script type="text/form-script">

        camForm.on('form-loaded', function () {
                camForm.variableManager.fetchVariable('PROCESS_NEXT_SCANPROCESSES');
            });

        camForm.on('variables-fetched', function () {

            $scope.nextProcess = camForm.variableManager.variableValue('PROCESS_NEXT_SCANPROCESSES')[0];
            if($scope.variables === undefined){
                $scope.variables = [];
            }
            $scope.addVariable = function () {
                $scope.variables.push({'name':'', 'value': '', 'type': ''});
            };

        });


        camForm.on('submit', function () {
            for(var i in $scope.variables){
                console.log("add: " + $scope.variables[i]);
                camForm.variableManager.createVariable({
                    name: $scope.variables[i].name,
                    type: $scope.variables[i].type,
                    value: $scope.variables[i].value,
                    valueInfo: {}
                });
            }
        });

    </script>

    <div class="row">

        <div class="col-xs-12">
            <h3>Variables for {{nextProcess}}</h3>

            <div class="form-group">
                <div class="controls row form-group" ng-repeat="variable in variables track by $index">
                    <div class="col-xs-4">
                        <label>Name</label>
                        <input required class="form-control"
                               type="text"
                               ng-minlength="2"
                               ng-maxlength="30"
                               ng-model="variable.name"/>
                    </div>
                    <div class="col-xs-4">
                        <label>Value</label>
                        <input required class="form-control"
                               type="text"
                               ng-maxlength="100"
                               ng-model="variable.value"
                               ng-keydown="checkForEnter($event)"
                        />
                    </div>
                    <div class="col-xs-3">
                        <label>Type</label>
                        <input required class="form-control"
                               type="text"
                               ng-maxlength="100"
                               ng-model="variable.type"
                               ng-keydown="checkForEnter($event)"
                        />
                    </div>
                    <div class="col-xs-1">
                        <button class="btn btn-danger btn-lg"
                                ng-click="variables.splice($index, 1)"
                                ng-disabled="variables.length === 0"
                                style="position: absolute; right: 15px; top: 0;">
                            <span class="glyphicon glyphicon-trash"></span>
                        </button>
                    </div>
                </div>
                <button class="btn btn-primary" ng-click="addVariable()">Add Variable</button>
                <code class="hidden2">{{ variables }}</code>
            </div>

        </div>
    </div>
</form>
